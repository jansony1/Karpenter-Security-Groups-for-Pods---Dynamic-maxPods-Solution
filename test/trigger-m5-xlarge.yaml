apiVersion: v1
kind: Pod
metadata:
  name: trigger-m5-xlarge
  labels:
    app: trigger-m5-xlarge
    instance-target: m5.xlarge
spec:
  nodeSelector:
    node-type: m5-dynamic-v2-fixed
  # Add node affinity to prefer m5 instances
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
          - key: node.kubernetes.io/instance-type
            operator: In
            values: ["m5.xlarge", "m5.2xlarge", "m5.4xlarge"]
  containers:
  - name: workload-container
    image: nginx:alpine
    resources:
      requests:
        cpu: 3500m      # 3.5 cores - requires m5.xlarge or larger
        memory: 12Gi    # 12GB memory - fits well in m5.xlarge 16GB
      limits:
        cpu: 3800m
        memory: 14Gi
    ports:
    - containerPort: 80
    env:
    - name: TARGET_INSTANCE
      value: "m5.xlarge"
    - name: WORKLOAD_TYPE
      value: "general-purpose"
    readinessProbe:
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 5
      periodSeconds: 10
  restartPolicy: Always
